<div class="container">
  <div class="page-header">
    <h1>{{ (list$ | async)?.listName }}</h1>
  </div>

  @if (loading) {
    <div class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  } @else {
    <div class="list-actions mb-3">
      <button mat-raised-button color="primary" (click)="openAddItemDialog()">
        <mat-icon>add</mat-icon> Adicionar Item
      </button>
    </div>

    @if ((listItems$ | async)?.length) {
      <mat-card appearance="outlined">
        <mat-card-content>
          @if (listItems$ | async; as items) {
            <table mat-table [dataSource]="items" class="item-table">
              <!-- Item Column -->
              <ng-container matColumnDef="item">
                <th mat-header-cell *matHeaderCellDef>Item</th>
                <td mat-cell *matCellDef="let element">
                  <div class="item-info">
                    <span [class.purchased]="element.purchased">{{ element.item.name }}</span>
                    <span class="item-category">{{ element.item.category.name }}</span>
                  </div>
                </td>
              </ng-container>

              <!-- Quantity Column -->
              <ng-container matColumnDef="quantity">
                <th mat-header-cell *matHeaderCellDef>Quantidade</th>
                <td mat-cell *matCellDef="let element">
                  {{ element.quantity }} {{ element.item.unit.symbol }}
                </td>
              </ng-container>

              <!-- Status Column -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let element">
                  <mat-checkbox
                    [checked]="element.purchased"
                    (change)="togglePurchased(element)">
                    {{ element.purchased ? 'Comprado' : 'Pendente' }}
                  </mat-checkbox>
                </td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Ações</th>
                <td mat-cell *matCellDef="let element">
                  <button
                    mat-icon-button
                    color="primary"
                    (click)="editItem(element)">
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button
                    mat-icon-button
                    color="warn"
                    (click)="removeItem(element)">
                    <mat-icon>delete</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
          }
        </mat-card-content>
      </mat-card>
    } @else {
      <mat-card appearance="outlined" class="empty-list">
        <mat-card-content>
          <p>Esta lista não possui itens.</p>
          <button mat-raised-button color="primary" (click)="openAddItemDialog()">
            Adicionar Item
          </button>
        </mat-card-content>
      </mat-card>
    }
  }
</div>
